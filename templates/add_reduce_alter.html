{% extends 'base.html' %}
{% load static %}
{% block content %}

<!-- Custom Styled Form -->
<form id="stockForm">
  {% csrf_token %}
  {% include 'includes/error.html' %}

  <h2 style="text-align:center; margin-bottom: 20px;">Add / Reduce Stock</h2>

  <!-- Category -->
  <label for="category">Category</label>
  <input type="text" id="category" value="{{ c|default:'' }}" readonly>

  <!-- Item -->
  <label for="item">Item</label>
  <input type="text" id="item" value="{{ i|default:'' }}" readonly>
  <input type="hidden" id="itemId" value="{{ items.id }}">

  <!-- Transaction Type -->
  <label for="transactionType">Transaction Type</label>
  <input type="text" id="transactionType" value="{{ t|default:'' }}" readonly>

  <!-- Quantity -->
  <label for="quantity">Quantity</label>
  <input type="number" id="quantity" name="quantity" min="1" >

  <!-- Submit -->
  <button type="submit">Submit</button>
</form>


<!-- AJAX Script -->
<script>
  $('#stockForm').on('submit', function (e) {
    e.preventDefault();
    const itemId = $('#itemId').val();
    const type = $('#transactionType').val();
    const quantity = $('#quantity').val();
    const accessToken = localStorage.getItem('access');

    $.ajax({
      url: '/api/add_reduce_stock/',
      method: 'POST',
      headers: {
        'Authorization': 'Bearer ' + accessToken,
        'Content-Type': 'application/json'
      },
      data: JSON.stringify({
        item: itemId,
        quantity: quantity,
        type: type
      }),
      success: function (response) {
        alert(response.message);
        window.location.href = '/dashboard/';
      },
      error: function (xhr) {
        const error = xhr.responseJSON?.error || 'Something went wrong.';
        alert(error);
      }
    });
  });
</script>

{% endblock %}
